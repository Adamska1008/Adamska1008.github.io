<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.2">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.2.1/css/all.min.css" integrity="sha256-Z1K5uhUaJXA7Ll0XrZ/0JhX4lAtZFpT6jkKrEDT0drU=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"adamska1008.github.io","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.14.1","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script>

    <meta name="description" content="包括以下内容：  存储器层次结构 存储器技术  RAM DRAM结构 存储扩展   高速缓存Cache  基本原理 相联存储器 替换算法   虚拟存储  TLB">
<meta property="og:type" content="article">
<meta property="og:title" content="《计算机组成与设计》选读（二）">
<meta property="og:url" content="https://adamska1008.github.io/2023/03/01/selective-COD-2/index.html">
<meta property="og:site_name" content="Adamska&#39;s Blog">
<meta property="og:description" content="包括以下内容：  存储器层次结构 存储器技术  RAM DRAM结构 存储扩展   高速缓存Cache  基本原理 相联存储器 替换算法   虚拟存储  TLB">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cstaleem.com/wp-content/uploads/2020/08/Memory-Hierarchy-in-COA.png">
<meta property="og:image" content="https://image1.slideserve.com/3419267/conventional-dram-organization-l.jpg">
<meta property="og:image" content="https://images.slideplayer.com/21/6302610/slides/slide_2.jpg">
<meta property="og:image" content="https://images.slideplayer.com/21/6302610/slides/slide_3.jpg">
<meta property="article:published_time" content="2023-03-01T04:10:55.000Z">
<meta property="article:modified_time" content="2023-03-04T07:07:26.627Z">
<meta property="article:author" content="Adamska">
<meta property="article:tag" content="算法竞赛, Modern C++, JVM, Kotlin, GoLang, Rust, Basic CS knowledge">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cstaleem.com/wp-content/uploads/2020/08/Memory-Hierarchy-in-COA.png">


<link rel="canonical" href="https://adamska1008.github.io/2023/03/01/selective-COD-2/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://adamska1008.github.io/2023/03/01/selective-COD-2/","path":"2023/03/01/selective-COD-2/","title":"《计算机组成与设计》选读（二）"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>《计算机组成与设计》选读（二） | Adamska's Blog</title>
  






  <script async defer data-website-id="" src=""></script>

  <script defer data-domain="" src=""></script>

  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --></head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">Adamska's Blog</p>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-tags"><a href="/tags" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
  </ul>
</nav>




</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AD%98%E5%82%A8%E5%99%A8%E5%B1%82%E6%AC%A1%E7%BB%93%E6%9E%84"><span class="nav-number">1.</span> <span class="nav-text"> 存储器层次结构</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AD%98%E5%82%A8%E5%99%A8%E6%8A%80%E6%9C%AF"><span class="nav-number">2.</span> <span class="nav-text"> 存储器技术</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#ram"><span class="nav-number">2.1.</span> <span class="nav-text"> RAM</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#dram%E7%BB%93%E6%9E%84"><span class="nav-number">2.2.</span> <span class="nav-text"> DRAM结构</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AD%98%E5%82%A8%E6%89%A9%E5%B1%95"><span class="nav-number">2.3.</span> <span class="nav-text"> 存储扩展</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%AB%98%E9%80%9F%E7%BC%93%E5%AD%98cache"><span class="nav-number">3.</span> <span class="nav-text"> 高速缓存Cache</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9F%BA%E6%9C%AC%E5%8E%9F%E7%90%86"><span class="nav-number">3.1.</span> <span class="nav-text"> 基本原理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9B%B8%E8%81%94%E5%AD%98%E5%82%A8%E5%99%A8"><span class="nav-number">3.2.</span> <span class="nav-text"> 相联存储器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9B%BF%E6%8D%A2%E7%AE%97%E6%B3%95"><span class="nav-number">3.3.</span> <span class="nav-text"> 替换算法</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%99%9A%E6%8B%9F%E5%AD%98%E5%82%A8"><span class="nav-number">4.</span> <span class="nav-text"> 虚拟存储</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#tlb"><span class="nav-number">4.1.</span> <span class="nav-text"> TLB</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Adamska</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">53</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">6</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags">
        <span class="site-state-item-count">20</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="cc-license animated" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="noopener" target="_blank"><img src="https://cdn.jsdelivr.net/npm/@creativecommons/vocabulary@2020.11.3/assets/license_badges/small/by_nc_sa.svg" alt="Creative Commons"></a>
  </div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://adamska1008.github.io/2023/03/01/selective-COD-2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Adamska">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Adamska's Blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="《计算机组成与设计》选读（二） | Adamska's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          《计算机组成与设计》选读（二）
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-03-01 12:10:55" itemprop="dateCreated datePublished" datetime="2023-03-01T12:10:55+08:00">2023-03-01</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-03-04 15:07:26" itemprop="dateModified" datetime="2023-03-04T15:07:26+08:00">2023-03-04</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E3%80%8A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E4%B8%8E%E8%AE%BE%E8%AE%A1%E3%80%8B%E9%80%89%E8%AF%BB/" itemprop="url" rel="index"><span itemprop="name">《计算机组成与设计》选读</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <p>包括以下内容：</p>
<ul>
<li><a href="#%E5%AD%98%E5%82%A8%E5%99%A8%E5%B1%82%E6%AC%A1%E7%BB%93%E6%9E%84">存储器层次结构</a></li>
<li><a href="#%E5%AD%98%E5%82%A8%E5%99%A8%E6%8A%80%E6%9C%AF">存储器技术</a>
<ul>
<li><a href="#ram">RAM</a></li>
<li><a href="#dram%E7%BB%93%E6%9E%84">DRAM结构</a></li>
<li><a href="#%E5%AD%98%E5%82%A8%E6%89%A9%E5%B1%95">存储扩展</a></li>
</ul>
</li>
<li><a href="#%E9%AB%98%E9%80%9F%E7%BC%93%E5%AD%98cache">高速缓存Cache</a>
<ul>
<li><a href="#%E5%9F%BA%E6%9C%AC%E5%8E%9F%E7%90%86">基本原理</a></li>
<li><a href="#%E7%9B%B8%E8%81%94%E5%AD%98%E5%82%A8%E5%99%A8">相联存储器</a></li>
<li><a href="#%E6%9B%BF%E6%8D%A2%E7%AE%97%E6%B3%95">替换算法</a></li>
</ul>
</li>
<li><a href="#%E8%99%9A%E6%8B%9F%E5%AD%98%E5%82%A8">虚拟存储</a>
<ul>
<li><a href="#tlb">TLB</a></li>
</ul>
</li>
</ul>
<span id="more"></span>
<h2 id="存储器层次结构"><a class="markdownIt-Anchor" href="#存储器层次结构"></a> 存储器层次结构</h2>
<p><strong>局部性原理</strong>：<br>
局部性原理表明在任何时间内，程序访问的只是地址空间相对较小的一部分。</p>
<ul>
<li><strong>时间局部性（temporal locality）</strong>：某个数据项在被访问之后可能很快被再次访问。</li>
<li><strong>空间局部性（spatial locality）</strong>：某个数据项被访问后，与其地址相邻的数据项可能很快被访问。</li>
</ul>
<p>我们利用局部性原理将计算机存储器组织为<strong>存储器层次结构（memory hierarchy）</strong>，存储器层次结构是一种由多存储器层次组成的结构，存储器的容量和访问时间随着离处理器距离的增加而增加。</p>
<p><img src="https://cstaleem.com/wp-content/uploads/2020/08/Memory-Hierarchy-in-COA.png" alt></p>
<p>数据交换只能出现在相邻的两层，存储信息交换的最小单元为<strong>块（block）<strong>或</strong>行（line）</strong>。如果处理器需要的数据存放在高层存储器中的某个块中，则称为一次<em>命中</em>，否则为<em>缺失</em>。</p>
<p><strong>命中率（hit rate 或 hit ratio）</strong> 是在高层存储器中找到数据的存储访问比例，是衡量存储器层次结构性能的一个标准。<strong>缺失率（missing rate）</strong> 则相反。</p>
<p><strong>命中时间（hit time）</strong> 是指访问存储器层次结构中的高层存储器所需要的时间，包括判断当前访问是命中还是缺失所需的时间。<strong>缺失代价（miss penalty）</strong> 是将相应的块替换到高层存储器中，以及传递给处理器的时间之和。</p>
<h2 id="存储器技术"><a class="markdownIt-Anchor" href="#存储器技术"></a> 存储器技术</h2>
<h3 id="ram"><a class="markdownIt-Anchor" href="#ram"></a> RAM</h3>
<p>RAM分为两类：静态的（SRAM）和动态的（DRAM）。SRAM比DRAM昂贵而快速，用于CPU内部或高速缓存；DRAM用于主存或显存。</p>
<p><strong>SRAM</strong><br>
SRAM将每个位存储在<em>双稳态（bistable）</em> 存储器单元（一个六晶体管电路）里，其特点是：可以无限期保持在两个电压之一，其他任何状态都是不稳定的。</p>
<p>因此，SRAM在通电后永久保存值，即使有干扰也会迅速恢复原值。</p>
<p><strong>DRAM</strong><br>
DRAM将每个位存储为对一个电容的充电。DRAM对于干扰非常敏感，当电容电压被扰乱后永远不会恢复。</p>
<table>
<thead>
<tr>
<th></th>
<th>每位晶体管数</th>
<th>相对访问时间</th>
<th>持续的？</th>
<th>敏感的？</th>
<th>相对花费</th>
<th>应用</th>
</tr>
</thead>
<tbody>
<tr>
<td>SRAM</td>
<td>6</td>
<td>1×</td>
<td>是</td>
<td>否</td>
<td>1000×</td>
<td>高速缓存</td>
</tr>
<tr>
<td>DRAM</td>
<td>1</td>
<td>10×</td>
<td>否</td>
<td>是</td>
<td>1×</td>
<td>主存，帧缓冲区</td>
</tr>
</tbody>
</table>
<h3 id="dram结构"><a class="markdownIt-Anchor" href="#dram结构"></a> DRAM结构</h3>
<p>DRAM芯片中的单元被分成d个<em>超单元（supercell）</em>，每个超单元由w个DRAM单元组成，一个d×w的DRAM总共存储了dw位信息。</p>
<p>超单元被组织为r行c列的阵列，满足r×c=d，每个超单元有形如（i，j）的地址，i表示行，j表示列。</p>
<p><img src="https://image1.slideserve.com/3419267/conventional-dram-organization-l.jpg" alt></p>
<p>从DRAM获取超单元数据分为两步：</p>
<ul>
<li>发送RAS（Row Access Strobe）选中行</li>
<li>发送CAS（Column Access Strobe）选中列</li>
</ul>
<p>DRAM将RAS选中的行复制到内部行缓冲区，等待CAS选择列。</p>
<p><img src="https://images.slideplayer.com/21/6302610/slides/slide_2.jpg" alt></p>
<p><img src="https://images.slideplayer.com/21/6302610/slides/slide_3.jpg" alt></p>
<p>使用二维阵列的好处是降低芯片上地址引脚的数量，缺点是必须分两步发送地址，增加了访问时间。</p>
<h3 id="存储扩展"><a class="markdownIt-Anchor" href="#存储扩展"></a> 存储扩展</h3>
<p>在应用中，可能出现存储芯片的容量或字长不能满足需求的情况，所以需要进行存储扩展。</p>
<p>将一个RAM表示为M×N，其中M表示容量，N表示存储的位数，常见扩展有三种类型：</p>
<ul>
<li><strong>位扩展</strong>：使用多个存储器表示位，使得存储位数扩展。由于芯片并行工作，同时增加了读取速度。</li>
<li><strong>字扩展</strong>：使用多个存储器存储容量，使得容量扩展</li>
<li><strong>字位扩展</strong>：同时扩展位数和容量</li>
</ul>
<h2 id="高速缓存cache"><a class="markdownIt-Anchor" href="#高速缓存cache"></a> 高速缓存Cache</h2>
<h3 id="基本原理"><a class="markdownIt-Anchor" href="#基本原理"></a> 基本原理</h3>
<p>高速缓存保存最近访问的数据块的集合，若处理器所要访问的块在cache中，则命中；反之导致一次缺失，该块从主存中调入cache中。</p>
<p>构建高速缓存需要处理两个问题：</p>
<ul>
<li>怎样知道一个块是否存在于cache中</li>
<li>怎样定位一个cache项</li>
</ul>
<p>根据主存地址直接分配缓存位置的方法被称为<strong>直接映射</strong>，一个存储器地址只对应cache中的一个位置。</p>
<p>一般使用取模方法，如果cache块数是2的幂，则对存储器数据取地址的低log<sub>2</sub>位为cache的<strong>索引（Index）</strong>。索引不需要记录在cache中。</p>
<p>这种计算方法导致cache中每个位置可能对应主存中不同地址。为了区分不同数据，cache中需要有<strong>标记（Tag）</strong>。标记储存了除cache索引位以外的其他高位。</p>
<p>例如5位地址的内存使用容量为8的cache，索引位为低3位，则标记位为高2位。</p>
<p>除此之外，还需判断一个cache块中是否包含有效信息的<strong>有效位（valid bit）</strong>。</p>
<p>通常，块可能有多字。CPU只访问字，为了确定字的位置，不仅需要确定块地址，还要知道<strong>块内偏移</strong>。一般来说，块内偏移就是内存地址的最低几位。如果一个块有四个字，内存地址的最低2位就是块内偏移的二进制表示。</p>
<h3 id="相联存储器"><a class="markdownIt-Anchor" href="#相联存储器"></a> 相联存储器</h3>
<p>在直接映射中，存储器中的一个块只能放到cache中一个明确的位置；与此相对的是全相联，存储器的块有可能放到cache中的任意位置，每一次查找数据都需要查找对照整个缓存的标记。</p>
<p>介于两者之间的设计是<strong>组相联</strong>：块可以放置到cache中的部分位置，每个块有n个位置可以放置的cache被称为n路组相联。</p>
<p>直接映射满足</p>
<p class="katex-block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>c</mi><mi>a</mi><mi>c</mi><mi>h</mi><mi>e</mi><mtext>位置</mtext><mo>=</mo><mo stretchy="false">(</mo><mtext>块号</mtext><mo stretchy="false">)</mo><mi>m</mi><mi>o</mi><mi>d</mi><mo stretchy="false">(</mo><mi>c</mi><mi>a</mi><mi>c</mi><mi>h</mi><mi>e</mi><mtext>块数</mtext><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">cache位置=(块号)mod(cache块数)
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathnormal">c</span><span class="mord mathnormal">a</span><span class="mord mathnormal">c</span><span class="mord mathnormal">h</span><span class="mord mathnormal">e</span><span class="mord cjk_fallback">位</span><span class="mord cjk_fallback">置</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord cjk_fallback">块</span><span class="mord cjk_fallback">号</span><span class="mclose">)</span><span class="mord mathnormal">m</span><span class="mord mathnormal">o</span><span class="mord mathnormal">d</span><span class="mopen">(</span><span class="mord mathnormal">c</span><span class="mord mathnormal">a</span><span class="mord mathnormal">c</span><span class="mord mathnormal">h</span><span class="mord mathnormal">e</span><span class="mord cjk_fallback">块</span><span class="mord cjk_fallback">数</span><span class="mclose">)</span></span></span></span></span></p>
<p>而在组相联映射中</p>
<p class="katex-block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>c</mi><mi>a</mi><mi>c</mi><mi>h</mi><mi>e</mi><mtext>位置</mtext><mo>=</mo><mo stretchy="false">(</mo><mtext>块号</mtext><mo stretchy="false">)</mo><mi>m</mi><mi>o</mi><mi>d</mi><mo stretchy="false">(</mo><mi>c</mi><mi>a</mi><mi>c</mi><mi>h</mi><mi>e</mi><mtext>组数</mtext><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">cache位置=(块号)mod(cache组数)
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathnormal">c</span><span class="mord mathnormal">a</span><span class="mord mathnormal">c</span><span class="mord mathnormal">h</span><span class="mord mathnormal">e</span><span class="mord cjk_fallback">位</span><span class="mord cjk_fallback">置</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord cjk_fallback">块</span><span class="mord cjk_fallback">号</span><span class="mclose">)</span><span class="mord mathnormal">m</span><span class="mord mathnormal">o</span><span class="mord mathnormal">d</span><span class="mopen">(</span><span class="mord mathnormal">c</span><span class="mord mathnormal">a</span><span class="mord mathnormal">c</span><span class="mord mathnormal">h</span><span class="mord mathnormal">e</span><span class="mord cjk_fallback">组</span><span class="mord cjk_fallback">数</span><span class="mclose">)</span></span></span></span></span></p>
<p>由于该块可能被放在组中的任何一个位置，因此所有块的标记都要被检索。</p>
<p>提高相联度的好处在于能够降低缺失率，缺点是增加命中时间。</p>
<h3 id="替换算法"><a class="markdownIt-Anchor" href="#替换算法"></a> 替换算法</h3>
<p>除了直接映射之外的其他缓存算法中，当组内位置被沾满时，就需要决定将哪个位置的块替换掉。常见的替换算法有随机替换法、FIFO、LFU、LRU。</p>
<ul>
<li>随机替换法：</li>
<li>FIFO</li>
<li>LFU（Least Frequently Used，最不经常使用）：对缓存进行计数，替换计数最小的块。</li>
<li>LRU（Least Recently Used，最近最少使用）：替换最久没有被使用的块。</li>
</ul>
<blockquote>
<p>假设主存和Cache之间采用直接映射方式，块大小为16B。Cache数据库容量为64KB，主存地址为32位，按字节编址，数据字长32位。</p>
<ol>
<li>给出直接映射方式下主存地址划分</li>
<li>完成Cache访问的硬件实现</li>
</ol>
</blockquote>
<blockquote>
<ol>
<li>块16B → 块内偏移4位<br>
Cache数据区容量64KB → 4096行Cache → 12位Index<br>
Tag字段：32-4-12=16位</li>
<li>计算Cache容量（假定有1位校验位）<br>
每行数据16<em>8=128bit<br>
每行容量1+16+128=145bit<br>
总容量145</em>4096=580Kbit</li>
</ol>
</blockquote>
<h2 id="虚拟存储"><a class="markdownIt-Anchor" href="#虚拟存储"></a> 虚拟存储</h2>
<p>虚拟内存将主存看成一个存储在磁盘上的地址空间的高速缓存，在主存中只保存活动区域，并根据需要在磁盘和主存之间来回传送数据。它提供了以下能力：</p>
<ol>
<li>为每个进程提供了一致的地址空间，从而简化了内存管理</li>
<li>保护了每个进程的地址空间，不被其他进程破坏</li>
</ol>
<p>虚拟存储器中，块称为<strong>页（page）</strong>，访问缺失称为<strong>缺页（page fault）</strong>。在虚拟存储器中，处理器产生<strong>虚拟内存（virtual address）</strong>，转换成<strong>物理地址（physical address）</strong>，用其访问主存。这个过程称为<strong>地址转换（address translation）</strong>。</p>
<p>在虚拟存储器中，地址被划分为<strong>虚页号（virtual page number）<strong>和</strong>页偏移（page offset）</strong>，在地址转换中页偏移不变，虚页号转换为<strong>物理页号（physical page number）</strong>。</p>
<p>由于缺页的代价非常高，倾向于牺牲命中时间而降低缺页率。为此使用全相联映射。为了优化定位，在虚拟存储系统中使用<strong>页表（page table）</strong> 来定位页。页表放置在存储器中。页表使用虚拟地址中的虚页号作为索引，找到相应的物理页号。每个程序有自己的页表。</p>
<p>为了指出页表在存储器中的位置，硬件包含一个指向页表首地址的寄存器：<strong>页表寄存器（page table register）</strong>。</p>
<h3 id="tlb"><a class="markdownIt-Anchor" href="#tlb"></a> TLB</h3>
<p>由于页表存放在主存中，程序需要两次访问来获取数据：第一次获得物理地址，第二次获取数据。</p>
<p>现代处理器包含一个特殊的cache跟踪最近使用过的地址变换：<strong>TLB（Translation-Lookaside Buffer）</strong>。</p>
<p>TLB每个标记项存放虚页号的一部分，数据项存放物理页号。TLB包括其他状态位，如脏位和引用位。</p>

    </div>

    
    
    

    <footer class="post-footer">
          

<div class="post-copyright">
<ul>
  <li class="post-copyright-author">
      <strong>本文作者： </strong>Adamska
  </li>
  <li class="post-copyright-link">
      <strong>本文链接：</strong>
      <a href="https://adamska1008.github.io/2023/03/01/selective-COD-2/" title="《计算机组成与设计》选读（二）">https://adamska1008.github.io/2023/03/01/selective-COD-2/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>


        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2023/02/26/selective-COD-1/" rel="prev" title="《计算机组成与设计》选读（一）">
                  <i class="fa fa-chevron-left"></i> 《计算机组成与设计》选读（一）
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2023/03/02/selective-COD-3/" rel="next" title="《计算机组成与设计》选读（三）">
                  《计算机组成与设计》选读（三） <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Adamska</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  

  <script class="next-config" data-name="mermaid" type="application/json">{"enable":true,"theme":{"light":"default","dark":"dark"},"js":{"url":"https://cdn.jsdelivr.net/npm/mermaid@9.3.0/dist/mermaid.min.js","integrity":"sha256-QdTG1YTLLTwD3b95jLqFxpQX9uYuJMNAtVZgwKX4oYU="}}</script>
  <script src="/js/third-party/tags/mermaid.js"></script>



  




  

  <script class="next-config" data-name="enableMath" type="application/json">true</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css" integrity="sha256-gMRN4/6qeELzO1wbFa8qQLU8kfuF2dnAPiUoI0ATjx8=" crossorigin="anonymous">



</body>
</html>
